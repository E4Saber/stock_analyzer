
1. 关于分析维度，历史新闻热点的影响
2. 关于国际热点的及时收集...


# API接口规范设计文档

## 1. 通用响应格式

所有API接口返回统一的JSON格式：

```json
{
  "code": 200,    // 状态码，200表示成功，其他值表示错误
  "message": "success",  // 状态描述
  "data": {}      // 具体业务数据，格式根据不同接口有所不同
}
```

## 2. 主要接口

### 2.1 获取市场指数列表

#### 请求
```
GET /api/market/indices
```

#### 响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "cn_indices": [
      {
        "code": "000001",  // 指数代码
        "name": "上证指数",  // 指数名称
        "current": 3273.76,  // 当前点位
        "change": 28.89,     // 涨跌点数
        "change_percent": 0.89  // 涨跌百分比
      },
      // 更多A股指数...
    ],
    "global_indices": [
      {
        "code": "DJI",
        "name": "道琼斯",
        "current": 34721.89,
        "change": 165.32,
        "change_percent": 0.48
      },
      // 更多全球指数...
    ]
  }
}
```

### 2.2 获取指数详情

#### 请求
```
GET /api/index/{index_code}
```

#### 响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "code": "000001",    // 指数代码
    "name": "上证指数",    // 指数名称
    "fullname": "上海证券交易所综合指数",  // 指数全称
    "market": "上海",     // 市场
    "publisher": "上海证券交易所",  // 发布机构
    "category": "综合",   // 指数类别
    "base_date": "1990-12-19",  // 基期
    "description": "反映上海证券交易所上市股票价格变动的统计指标",  // 描述
    
    // 最新行情数据
    "current": 3273.76,  // 当前点位
    "change": 28.89,     // 涨跌点数
    "change_percent": 0.89,  // 涨跌百分比
    "open": 3245.87,     // 开盘点位
    "high": 3280.12,     // 最高点位
    "low": 3240.56,      // 最低点位
    "pre_close": 3244.87,  // 前收盘点位
    "volume": 21500000.0,  // 成交量
    "amount": 265432100.0,  // 成交额
    "date": "20230615",    // 交易日期
    
    // K线历史数据
    "kline_data": [
      {
        "date": "2023-06-15",  // 日期
        "open": 3245.87,       // 开盘价
        "close": 3273.76,      // 收盘价
        "low": 3240.56,        // 最低价
        "high": 3280.12,       // 最高价
        "volume": 21500000.0,  // 成交量
        "amount": 265432100.0  // 成交额
      },
      // 更多历史数据...
    ]
  }
}
```

### 2.3 获取指数K线数据

#### 请求
```
GET /api/index/{index_code}/kline?period={period}
```

参数说明：
- `period`: 周期类型，支持 day/week/month/1m/5m/15m/30m/60m

#### 响应
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "date": "2023-06-15",    // 日期时间
      "open": 3245.87,         // 开盘价
      "close": 3273.76,        // 收盘价
      "low": 3240.56,          // 最低价
      "high": 3280.12,         // 最高价
      "volume": 21500000.0,    // 成交量
      "amount": 265432100.0    // 成交额
    },
    // 更多K线数据...
  ]
}
```

### 2.4 获取技术指标数据

#### 请求
```
GET /api/stock/{stock_code}/indicators?period={period}&indicators={indicators}
```

参数说明：
- `period`: 周期类型，支持 day/week/month/1m/5m/15m/30m/60m
- `indicators`: 指标列表，多个指标用逗号分隔，如 "MACD,KDJ,RSI"

#### 响应
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "MACD": {
      "DIF": [
        ["2023-06-15", 3.42],  // [日期, 值]
        // 更多数据...
      ],
      "DEA": [
        ["2023-06-15", 2.16],
        // 更多数据...
      ],
      "MACD": [
        ["2023-06-15", 2.52],
        // 更多数据...
      ],
      "HIST": [
        ["2023-06-15", 2.52],
        // 更多数据...
      ]
    },
    "KDJ": {
      "K": [
        ["2023-06-15", 65.32],
        // 更多数据...
      ],
      "D": [
        ["2023-06-15", 60.45],
        // 更多数据...
      ],
      "J": [
        ["2023-06-15", 75.06],
        // 更多数据...
      ]
    },
    // 更多指标数据...
  }
}
```

## 3. API与前端组件的映射关系

前端组件与API的对应关系：

1. **Dashboard.tsx**：
   - 调用 `/api/market/indices` 获取首页指数卡片数据
   - 同时获取热力图和热门股票数据

2. **StockAnalysisPanel.tsx**：
   - 调用 `/api/index/{index_code}/kline` 获取K线数据
   - 调用 `/api/stock/{stock_code}/indicators` 获取技术指标数据

3. **IndexChart.tsx / EnhancedIndexChart.tsx**：
   - 调用 `/api/index/{index_code}/kline` 获取指数走势图数据

4. **StockDetail.tsx**：
   - 调用 `/api/index/{index_code}` 获取指数详情
   - 调用其他API获取财务数据等

## 4. API数据格式与前端需求的匹配

API数据格式已经针对前端组件需求进行了优化：

1. **K线数据**：
   - 日期格式使用 `YYYY-MM-DD` 或 `YYYY-MM-DD HH:MM:SS` 格式，便于前端处理
   - 数据项包含完整的OHLCV信息（开盘、最高、最低、收盘、成交量）
   - 按日期倒序排列，最新数据在前，符合前端常见展示需求

2. **指标数据**：
   - 每个指标数据都遵循 `[日期, 值]` 的二维数组格式，可直接用于图表绘制
   - 指标数据的日期与K线保持一致，确保图表对齐

3. **指数详情**：
   - 包含完整的基本信息和最新行情
   - 同时附带一定的历史K线数据，减少额外请求

## 5. 数据流转示意图

```
┌────────────┐     ┌─────────────┐     ┌────────────┐
│   数据库   │ ──► │  后端处理层  │ ──► │  API接口   │
└────────────┘     └─────────────┘     └────────────┘
                                            │
                                            ▼
┌────────────┐     ┌─────────────┐     ┌────────────┐
│  UI展示    │ ◄── │  前端组件   │ ◄── │ API响应    │
└────────────┘     └─────────────┘     └────────────┘
```

通过这种设计，我们确保了数据从后端到前端的高效流转，减少了前端的数据转换工作，同时保持了API响应的一致性和可预测性。